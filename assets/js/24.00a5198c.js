(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{467:function(e,n,r){"use strict";r.r(n);var t=r(2),s=Object(t.a)({},(function(){var e=this,n=e._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h3",{attrs:{id:"配置防盗链"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置防盗链"}},[e._v("#")]),e._v(" 配置防盗链")]),e._v(" "),n("p",[n("code",[e._v("/nginx/share/nginx/html/assets/error.webp")])]),e._v(" "),n("p",[n("img",{attrs:{src:"/blogs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Nginx%E9%98%B2%E7%9B%97%E9%93%BE%E6%8A%80%E6%9C%AF/error.png",alt:"image.png"}})]),e._v(" "),n("p",[n("code",[e._v("/nginx/share/nginx/html/ok.png")])]),e._v(" "),n("p",[n("img",{attrs:{src:"/blogs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Nginx%E9%98%B2%E7%9B%97%E9%93%BE%E6%8A%80%E6%9C%AF/browser-ok.png",alt:"image.png"}})]),e._v(" "),n("p",[n("strong",[e._v("Nginx配置文件如下：")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("user www-data;\nworker_processes auto;\n\npid /run/nginx.pid;\n\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    server {\n        listen 80; # 监听HTTP端口\n        server_name localhost; # 服务器名，此处使用localhost仅做本地测试\n\n        root /usr/share/nginx/html; # 静态文件根目录\n        index index.html index.htm; # 默认索引文件\n\n        # 静态资源防盗链配置\n        location ~* ^.+\\.(gif|jpg|png|jpeg|swf|flv|rar|zip)$ {\n            # none 不携带 referer 的可以访问\n\t    # blocked x.x.x.x 指定允许访问的IP或域名\n            valid_referers none blocked localhost;\n            \n            # 如果没有通过防盗链，则指定访问如下错误的资源或返回403错误 \n            if ($invalid_referer) {\n                rewrite ^/ http://172.20.10.7:80/assets/error.webp;\n                break;\n            }\n        }\n    }\n}\n")])])]),n("p",[e._v("浏览器地址栏输入："),n("code",[e._v("http:localhost/assets/ok.png")]),e._v(" 结果如下图：")]),e._v(" "),n("p",[n("img",{attrs:{src:"/blogs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Nginx%E9%98%B2%E7%9B%97%E9%93%BE%E6%8A%80%E6%9C%AF/ok.png",alt:"image.png"}})]),e._v(" "),n("p",[e._v("通过 Apifox 请求 "),n("code",[e._v("localhost")]),e._v(" 域名携带 "),n("code",[e._v("Referer")]),e._v(" 为 "),n("code",[e._v("http://localhost")]),e._v(" 或 不携带 "),n("code",[e._v("Referer")]),e._v("，结果如下图（ 该结果是ok的图片 ）：\n"),n("img",{attrs:{src:"/blogs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Nginx%E9%98%B2%E7%9B%97%E9%93%BE%E6%8A%80%E6%9C%AF/block.png",alt:"block.png"}})]),e._v(" "),n("p",[e._v("通过 Apifox 请求 "),n("code",[e._v("localhost")]),e._v(" 域名携带 "),n("code",[e._v("Referer")]),e._v("为 非 blocked 下的IP，结果如下图（ 该结果是error.webp 的图片 ）：")]),e._v(" "),n("p",[n("img",{attrs:{src:"/blogs/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Nginx%E9%98%B2%E7%9B%97%E9%93%BE%E6%8A%80%E6%9C%AF/no-block.png",alt:"no-block.png"}})]),e._v(" "),n("h3",{attrs:{id:"配置反防盗链"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置反防盗链"}},[e._v("#")]),e._v(" 配置反防盗链")]),e._v(" "),n("ol",[n("li",[e._v("通过设置不携带请求头的 "),n("code",[e._v("referer")])])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('# 在 html 设置 meta 标签\n<meta name="referrer" content="no-referrer">\n')])])])])}),[],!1,null,null,null);n.default=s.exports}}]);